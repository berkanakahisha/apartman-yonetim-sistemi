<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>Apartman Yönetim Paneli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />

    <!-- PDF için jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

    <!-- Excel için SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="app">
        <header class="app-header">
            <div>
                <h1>Apartman Yönetim Paneli</h1>
                <p class="subtitle">Aidat, gelir–gider takibi, rapor ve Excel çıktısı</p>
            </div>
            <div class="header-right">
                <label class="month-label">
                    Ay Seç:
                    <input type="month" id="monthSelect" />
                </label>
            </div>
        </header>

        <section class="toolbar">
            <button id="btnAddResident" class="btn primary">Yeni Daire / Kullanıcı</button>
            <button id="btnExportPDF" class="btn">PDF Rapor</button>
            <button id="btnExportExcel" class="btn">Excel Çıktısı</button>
            <button id="btnClearData" class="btn danger outline">Tüm Veriyi Sil</button>
        </section>

        <section class="content">
            <!-- DAİRELER TABLOSU -->
            <div class="table-card">
                <div class="table-header">
                    <h2>Aidat Listesi</h2>
                    <div class="summary">
                        <span>Toplam Aylık Aidat: <strong id="summaryMonthlyFee">0</strong> ₺</span>
                        <span>Bu Ay Ödenen: <strong id="summaryPaid">0</strong> ₺</span>
                        <span>Kalan: <strong id="summaryRemaining">0</strong> ₺</span>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table id="residentTable">
                        <thead>
                            <tr>
                                <th>Daire No</th>
                                <th>İsim / Soyisim</th>
                                <th>Aylık Aidat (₺)</th>
                                <th>Bu Ay Ödenen (₺)</th>
                                <th>Kalan Borç (₺)</th>
                                <th>Not</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody id="residentTableBody"></tbody>
                    </table>
                </div>
                <p class="hint">
                    Veriler tarayıcıdaki <strong>localStorage</strong>'da saklanır.
                </p>
            </div>

            <!-- GELİR – GİDER KARTI -->
            <div class="table-card finance-card">
                <!-- YIL GENELİ ÖZET PANELİ -->
<div class="table-card" id="yearSummaryCard">
    <div class="table-header">
        <h2>Yıl Genel Özeti</h2>
        <label>
            Yıl Seç:
            <select id="yearSelect"></select>
        </label>
    </div>

    <div class="summary">
        <span>Yıllık Toplam Gelir: <strong id="yearIncome">0</strong> ₺</span>
        <span>Yıllık Toplam Gider: <strong id="yearExpense">0</strong> ₺</span>
        <span>Net Kasa: <strong id="yearNet">0</strong> ₺</span>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Ay</th>
                    <th>Aidat Geliri (₺)</th>
                    <th>Gider (₺)</th>
                    <th>Net (₺)</th>
                </tr>
            </thead>
            <tbody id="yearSummaryTableBody"></tbody>
        </table>
    </div>
</div>

                <div class="table-header">
                    <h2>Gelir &amp; Gider Özeti</h2>
                    <div class="summary">
                        <span>Bu Ay Toplam Gelir: <strong id="summaryIncome">0</strong> ₺</span>
                        <span>Bu Ay Toplam Gider: <strong id="summaryExpense">0</strong> ₺</span>
                        <span class="net-wrapper">Net Kasa: <strong id="summaryNet">0</strong> ₺</span>
                    </div>
                </div>

                <div class="finance-toolbar">
                    <button id="btnAddExpense" class="btn">Gider Ekle</button>
                </div>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Tarih</th>
                                <th>Kategori</th>
                                <th>Açıklama</th>
                                <th>Tutar (₺)</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody id="expenseTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <!-- Kullanıcı ekleme / düzenleme modal -->
    <div class="modal-backdrop" id="residentModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="residentModalTitle">Yeni Kullanıcı / Daire</h2>
                <button id="modalCloseBtn" class="icon-btn">✕</button>
            </div>
            <form id="residentForm" class="modal-body">
                <input type="hidden" id="residentId" />

                <label>Daire No
                    <input type="text" id="flatNo" required>
                </label>
                <label>İsim Soyisim
                    <input type="text" id="fullName" required>
                </label>
                <label>Aylık Aidat
                    <input type="number" id="monthlyFee" required min="0" step="0.01">
                </label>
                <label>Bu Ay Ödenen
                    <input type="number" id="paidThisMonth" value="0" min="0" step="0.01">
                </label>
                <label>Not
                    <textarea id="note"></textarea>
                </label>

                <button type="submit" class="btn primary">Kaydet</button>
            </form>
        </div>
    </div>

    <!-- GİDER MODALI -->
    <div class="modal-backdrop" id="expenseModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="expenseModalTitle">Yeni Gider</h2>
                <button id="expenseModalCloseBtn" class="icon-btn">✕</button>
            </div>
            <form id="expenseForm" class="modal-body">
                <input type="hidden" id="expenseId" />

                <label>Tarih
                    <input type="date" id="expenseDate" required>
                </label>
                <label>Kategori
                    <input type="text" id="expenseCategory" placeholder="Örn: Elektrik, Temizlik">
                </label>
                <label>Açıklama
                    <input type="text" id="expenseDescription">
                </label>
                <label>Tutar (₺)
                    <input type="number" id="expenseAmount" required min="0" step="0.01">
                </label>

                <button type="submit" class="btn primary">Kaydet</button>
            </form>
        </div>
    </div>

    <!-- ÖDEME GEÇMİŞİ MODALI -->
    <div class="modal-backdrop" id="historyModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="historyModalTitle">Ödeme Geçmişi</h2>
                <button id="historyModalCloseBtn" class="icon-btn">✕</button>
            </div>
            <div class="modal-body">
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Ay</th>
                                <th>Aidat (₺)</th>
                                <th>Ödenen (₺)</th>
                                <th>Kalan (₺)</th>
                            </tr>
                        </thead>
                        <tbody id="historyList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- GİRİŞ EKRANI -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h2>Apartman Yönetimi Giriş</h2>

            <label>Kullanıcı Adı</label>
            <input type="text" id="loginUsername">

            <label>Şifre</label>
            <input type="password" id="loginPassword">

            <button id="loginBtn" class="btn primary">Giriş Yap</button>

            <p id="loginError" class="error-text"></p>
                   </div>
    </div>
    <!-- Firebase (tarayıcı için CDN) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
    <!-- Firebase -->
<script src="firebase-app-compat.js"></script>
<script src="firebase-firestore-compat.js"></script>

<!-- Firebase Config -->
<script>
firebase.initializeApp(...);
const db = firebase.firestore();
</script>

<!-- Senin kodun (EN SON OLMALI) -->
<script src="app.js"></script>

    </script>
